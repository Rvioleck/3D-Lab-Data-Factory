# AI 3D Backend 项目公共模块参考

本文档提炼了项目中的公共模块和组件，作为后续开发的参考指南。

## 1. 通用响应模型

### 路径: `src/main/java/com/elwg/ai3dbackend/common/`

- **BaseResponse.java**: 通用响应类，封装接口的统一响应格式
- **ResultUtils.java**: 响应工具类，用于生成各种类型的响应对象
- **PageRequest.java**: 分页请求参数
- **PageResponse.java**: 分页响应结果
- **DeleteRequest.java**: 通用删除请求

## 2. 异常处理

### 路径: `src/main/java/com/elwg/ai3dbackend/exception/`

- **BusinessException.java**: 业务异常类
- **GlobalExceptionHandler.java**: 全局异常处理器
- **ErrorCode.java**: 错误码枚举
- **ThrowUtils.java**: 抛出异常工具类

## 3. 权限控制

### 路径: `src/main/java/com/elwg/ai3dbackend/annotation/`

- **AuthCheck.java**: 权限校验注解

### 路径: `src/main/java/com/elwg/ai3dbackend/aop/`

- **AuthInterceptor.java**: 权限校验拦截器

## 4. 常量定义

### 路径: `src/main/java/com/elwg/ai3dbackend/constant/`

- **UserConstant.java**: 用户相关常量

## 5. 枚举类型

### 路径: `src/main/java/com/elwg/ai3dbackend/model/enums/`

- **UserRoleEnum.java**: 用户角色枚举

## 6. 配置类

### 路径: `src/main/java/com/elwg/ai3dbackend/config/`

- **CorsConfig.java**: 全局跨域配置
- **WebMvcConfig.java**: Web MVC 配置
- **MybatisPlusConfig.java**: MyBatis-Plus 配置
- **JacksonConfig.java**: Jackson JSON 配置
- **AsyncConfig.java**: 异步任务配置
- **DeepSeekConfig.java**: DeepSeek API 配置
- **CosClientConfig.java**: 腾讯云对象存储客户端配置

## 7. 存储服务

### 路径: `src/main/java/com/elwg/ai3dbackend/service/`

- **FileStorageService.java**: 文件存储服务接口

### 路径: `src/main/java/com/elwg/ai3dbackend/service/impl/`

- **CosFileStorageServiceImpl.java**: 腾讯云对象存储服务实现

### 路径: `src/main/java/com/elwg/ai3dbackend/manager/`

- **CosManager.java**: 腾讯云对象存储管理器

## 8. 工具类

### 路径: `src/main/java/com/elwg/ai3dbackend/utils/`

- **ImageUtils.java**: 图片处理工具类

## 9. 用户服务

### 路径: `src/main/java/com/elwg/ai3dbackend/service/`

- **UserService.java**: 用户服务接口

### 路径: `src/main/java/com/elwg/ai3dbackend/service/impl/`

- **UserServiceImpl.java**: 用户服务实现类

## 10. 3D重建服务

### 路径: `src/main/java/com/elwg/ai3dbackend/service/`

- **ReconstructionHttpService.java**: 3D重建HTTP通信服务接口

### 路径: `src/main/java/com/elwg/ai3dbackend/service/impl/`

- **ReconstructionHttpServiceImpl.java**: 3D重建HTTP通信服务实现类

## 11. 实体类和视图对象

### 路径: `src/main/java/com/elwg/ai3dbackend/model/entity/`

- **User.java**: 用户实体类

### 路径: `src/main/java/com/elwg/ai3dbackend/model/vo/`

- **UserVO.java**: 用户视图对象

## 12. 配置文件

### 路径: `src/main/resources/`

- **application.yml**: 主配置文件
- **application-dev.yml**: 开发环境配置
- **application-prod.yml**: 生产环境配置

### 路径: `src/test/resources/`

- **application-test.yml**: 测试环境配置

## 13. 数据库脚本

### 路径: `src/main/resources/db/`

- **user.sql**: 用户表创建脚本

## 14. API文档

### 路径: 项目根目录

- **API.md**: API接口文档

## 使用指南

### 响应处理

使用 `ResultUtils` 生成统一格式的响应：

```java
// 成功响应（无数据）
return ResultUtils.success();

// 成功响应（带数据）
return ResultUtils.success(data);

// 成功响应（带数据和自定义消息）
return ResultUtils.success(data, "操作成功");

// 失败响应（使用错误码枚举）
return ResultUtils.error(ErrorCode.PARAMS_ERROR);

// 失败响应（使用错误码枚举和自定义错误信息）
return ResultUtils.error(ErrorCode.PARAMS_ERROR, "参数不合法");
```

### 异常处理

使用 `ThrowUtils` 在条件满足时抛出异常：

```java
// 条件成立则抛出指定的业务异常
ThrowUtils.throwIf(condition, ErrorCode.PARAMS_ERROR, "参数不合法");

// 条件成立则抛出指定的运行时异常
ThrowUtils.throwIf(condition, new RuntimeException("发生错误"));
```

### 权限控制

使用 `@AuthCheck` 注解进行权限校验：

```java
// 需要管理员权限
@AuthCheck(mustRole = "admin")
@GetMapping("/list")
public BaseResponse<List<User>> listUsers() {
    // 实现代码
}

// 需要普通用户权限
@AuthCheck(mustRole = "user")
@GetMapping("/info")
public BaseResponse<UserVO> getUserInfo() {
    // 实现代码
}
```

### 文件存储

使用 `FileStorageService` 进行文件操作：

```java
// 保存文件
fileStorageService.saveFile(filePath, fileData);

// 获取文件URL
String fileUrl = fileStorageService.getFileUrl(filePath);

// 获取文件数据
byte[] fileData = fileStorageService.getFileData(filePath);

// 检查文件是否存在
boolean exists = fileStorageService.isFileExists(filePath);

// 删除文件
boolean deleted = fileStorageService.deleteFile(filePath);
```

### 用户服务

使用 `UserService` 进行用户相关操作：

```java
// 获取当前登录用户
User loginUser = userService.getLoginUser(request);

// 用户登录
UserVO userVO = userService.userLogin(userAccount, userPassword, request);

// 用户注册
Long userId = userService.userRegister(userAccount, userPassword, checkPassword);

// 用户登出
userService.userLogout(request);
```

### 3D重建服务

使用 `ReconstructionHttpService` 进行3D重建操作：

```java
// 发送图片数据进行3D重建
CompletableFuture<String> future = reconstructionHttpService.sendImageForReconstruction(imageData, taskId, callbackUrl);

// 检查服务健康状态
boolean isHealthy = reconstructionHttpService.checkServiceHealth();
```
